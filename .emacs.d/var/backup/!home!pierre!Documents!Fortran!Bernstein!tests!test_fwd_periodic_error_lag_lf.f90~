program main
  use m_kind
  use m_file_function
  use m_polynom
  use m_matrix
  use m_acoustic
  use m_init_application
  use m_animation

  implicit none
  
  !*************** Main Variables ***********************************************
  type(acoustic_problem)              :: forward

  real(mp)                            :: t
  integer                             :: i,j,k
  !******************************************************************************

  call setup_parameters('forward')
  bernstein=.false.
  time_scheme='LF'
  signal='ricker'
  boundaries='periodic'
  final_time=1.0_mp
  
  do order=1,10

     call init_polynom(order)
     call init_acoustic_problem(forward,nb_elem,DoF,time_scheme,velocity_data,     &
          density_data,total_length,final_time,alpha,        &
          bernstein,signal,boundaries,source_loc,receiver_loc)

     t=0

     do i=1,forward%n_time_step
        t=i*forward%dt
        call progress_bar(i,forward%n_time_step)
        call one_forward_step(forward,t)
     end do

     
     print*,'final_time test :',final_time,order
  
     
     call free_acoustic_problem(forward)
     call free_polynom
  end do

  contains

  subroutine my_return(bool)
    logical,intent(in) :: bool

    if (bool) then
       print*,'Succeed'
    else
       ERROR STOP "TEST FAILED"
    end if
  end subroutine my_return

end program main
